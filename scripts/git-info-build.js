import { writeFile } from "node:fs/promises";
import {VARIABLES_REPLACE_AFTER_TEST_COMMENT} from "./replace-between.js";

const PACKAGE_GENERATED_PATH = "./esnext/package.readonly.ts"

{

    const {
        info,
        date,
        secondsBetweenCommitAndBuild,
        minutesBetweenCommitAndBuild,
        timeBetweenCommitAndBuild
    } = await import("./git-info.js");

    const packageReadonlyContents = `
// File generated by scripts/git-info-build.js

export const commit = "${info.commit}";
export const commitShort = "${info.shortCommit}";
export const commitAuthor = "${info.author}";
export const commitEmail = "${info.email}";
export const commitMessage = "${info.message}";
export const commitAt = "${date.toISOString()}";
export const secondsBetweenCommitAndBuild = ${Math.round(secondsBetweenCommitAndBuild * 100) / 100};
export const minutesBetweenCommitAndBuild = ${Math.round(minutesBetweenCommitAndBuild * 100) / 100};
export const timeBetweenCommitAndBuild = "${timeBetweenCommitAndBuild}";
${VARIABLES_REPLACE_AFTER_TEST_COMMENT}
export const secondsBetweenCommitAndTestCompletion = "";
export const minutesBetweenCommitAndTestCompletion = "";
export const timeBetweenCommitAndTestCompletion = "";
    `.trim();

    await writeFile(PACKAGE_GENERATED_PATH, packageReadonlyContents, "utf-8");
}